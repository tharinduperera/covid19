DROP DATABASE IF EXISTS COVID_19;

CREATE DATABASE COVID_19;

USE COVID_191;

CREATE TABLE user(
username VARCHAR(50) NOT NULL PRIMARY KEY,
name VARCHAR(80) NOT NULL,
contact_no VARCHAR(11) NOT NULL,
email VARCHAR(50) NOT NULL,
password VARCHAR(15) NOT NULL,
role ENUM('Admin','PSTF Member','Quarantine IT') NOT NULL
);

CREATE TABLE golbal_covid_data(
date DATE NOT NULL PRIMARY KEY,
confirmrd_cases INT(11),
recovered_cases INT(11),
deaths INT(11)
);

CREATE TABLE people(
id INT NOT NULL PRIMARY KEY,
first_name VARCHAR(45) NOT NULL,
last_name VARCHAR(45) NOT NULL,
address VARCHAR(100) NOT NULL,
city VARCHAR(45) NOT NULL,
district VARCHAR(45) NOT NULL,
province VARCHAR(45) NOT NULL,
nic VARCHAR(15) NOT NULL,
contact_number VARCHAR(45) NOT NULL,
blood_group VARCHAR(45) NOT NULL
);

CREATE TABLE center(
id INT(11) NOT NULL PRIMARY KEY,
name VARCHAR(50) NOT NULL,
city VARCHAR(50) NOT NULL,
district VARCHAR(50) NOT NULL,
capacity INT(11) NOT NULL,
head VARCHAR(50) NOT NULL,
head_contact_no VARCHAR(15) NOT NULL,
center_contact_no1 VARCHAR(15) NOT NULL,
center_contact_no2 VARCHAR(15) NOT NULL
);

CREATE TABLE hospital(
id INT(11) NOT NULL PRIMARY KEY,
name VARCHAR(50) NOT NULL,
city VARCHAR(50) NOT NULL,
district VARCHAR(50) NOT NULL,
capacity INT(11) NOT NULL,
director VARCHAR(50) NOT NULL,
director_contact_no VARCHAR(15) NOT NULL,
hospital_contact_no1 VARCHAR(15) NOT NULL,
hospital_contact_no2 VARCHAR(15) NOT NULL,
hospital_fax_no VARCHAR(15) NOT NULL,
email VARCHAR(50) NOT NULL
);

CREATE TABLE user_center(
username VARCHAR(50) NOT NULL,
center_id INT(11) NOT NULL,
PRIMARY KEY (username,center_id),
CONSTRAINT FOREIGN KEY (username) REFERENCES user(username),
CONSTRAINT FOREIGN KEY (center_id) REFERENCES center(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE user_hospital(
username VARCHAR(50) NOT NULL,
hospital_id INT(11) NOT NULL,
PRIMARY KEY (username,hospital_id),
CONSTRAINT FOREIGN KEY (username) REFERENCES user(username) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (hospital_id) REFERENCES hospital(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE covid_positive(
id INT NOT NULL PRIMARY KEY,
date DATETIME NOT NULL,
found VARCHAR(500) NOT NULL,
CONSTRAINT FOREIGN KEY (id) REFERENCES people(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE patient(
id INT NOT NULL,
hospital INT NOT NULL,
date DATETIME NOT NULL,
reason VARCHAR(500) NOT NULL,
CONSTRAINT PRIMARY KEY (date,id,hospital),
CONSTRAINT FOREIGN KEY (id) REFERENCES people(id) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (hospital) REFERENCES hospital(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE suspected(
id INT NOT NULL PRIMARY KEY,
reason VARCHAR(500) NOT NULL,
date DATETIME NOT NULL,
CONSTRAINT FOREIGN KEY (id) REFERENCES people(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE quarantined(
id INT PRIMARY KEY,
reason VARCHAR(500) NOT NULL,
entered_date DATETIME NOT NULL,
center INT NOT NULL,
CONSTRAINT FOREIGN KEY (id) REFERENCES people(id) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (center) REFERENCES center(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE reference(
suspected_id INT NOT NULL,
reference_id INT NOT NULL,
connection VARCHAR(500) NOT NULL,
PRIMARY KEY (suspected_id,reference_id),
CONSTRAINT FOREIGN KEY (suspected_id) REFERENCES people(id) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (reference_id) REFERENCES suspected(id) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (reference_id) REFERENCES patient(id) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (reference_id) REFERENCES quarantined(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE auto_remove(
id INT NOT NULL PRIMARY KEY,
date DATETIME NOT NULL,
CONSTRAINT FOREIGN KEY (id) REFERENCES suspected(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE exit_data(
id INT NOT NULL,
exit_reason ENUM('DISCHARGED','TRANSFERED','DEAD') NOT NULL,
`from` INT NOT NULL,
`to` VARCHAR(45) NOT NULL,
location ENUM('HOSPITAL','QUARANTINE CENTER') NOT NULL,
date DATETIME NOT NULL,
CONSTRAINT PRIMARY KEY (id,`from`,location),
CONSTRAINT FOREIGN KEY (id) REFERENCES patient(id) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (id) REFERENCES quarantined(id) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (`from`) REFERENCES hospital(id) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (`from`) REFERENCES center(id) ON UPDATE CASCADE ON DELETE CASCADE
);


